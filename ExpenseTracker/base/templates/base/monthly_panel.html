{% extends 'base/summary_layout.html' %}

{% block custom-script %}

<!--Icon for Go left-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<!--Icon for Go Right-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<script>
  $(document).ready(() => {
    $('#change-date').click(() => {
      let dateForm = document.querySelector('#date-form');
      let dateTitle = document.querySelector('#date-title');
      if (dateForm.style.display === 'none') {
        dateForm.style.display = 'inline';
        dateTitle.style.display = 'none';
      }
      else {
        dateForm.style.display = 'none';
        dateTitle.style.display = 'inline';
      }
    });
    $('#date-input-month').change(() => {
      $('#date-form').submit();
    });
  });
  
</script>

{% endblock %}

{% block container-header %}
<h3>Monthly Panel</h3>

<a href="{% url 'monthly-panel' %}?year={{prev_date_year}}&month={{prev_date_month}}" style="display: inline"><span class="material-symbols-outlined">arrow_back_ios</span></a>


<h2 id="date-title" style="display: inline">{{month_name}}, {{year}}</h2>

<form action="{% url 'monthly-panel'%}" method="GET" id="date-form" style="display: none;">
  <input type="month" id="date-input-month" name="date" style="width: 250px">
</form>
<span id="change-date" class="material-symbols-outlined" style="display: inline">edit</span>

<a href="{% url 'monthly-panel' %}?year={{next_date_year}}&month={{next_date_month}}" style="display: inline"><span class="material-symbols-outlined">arrow_forward_ios</span></a>
<!-- <form action="{% url 'monthly-panel'%}" method="GET" id="date-form">
  <select class="form-select" name="month">
    {% for select_month_name, month_value in month_range.items %}
      {% if select_month_name == month_name %}
        <option value="{{month_value}}" selected>{{select_month_name}}</option>
      {% else %}
        <option value="{{month_value}}">{{select_month_name}}</option>
      {% endif %}
    {% endfor %}
    
  </select>

  <select class="form-select" name="year">
    {% for select_year in year_range %}
      {% if select_year == year %}
        <option value="{{select_year}}" selected>{{select_year}}</option>
      {% else %}
        <option value="{{select_year}}">{{select_year}}</option>
      {% endif %}
    {% endfor %}
  </select>

  <input type="submit">
</form> -->



{% endblock %}



{% block expense-table %}
<h4>Recent Expenses</h4>
<table class="table table-sm table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Category</th>
        <th scope="col">Cost</th>
        <th scope="col">Date</th>
        <th scope="col">Description</th>
        <th scope="col"></th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
        {% for expense in limited_expenses %}
        <tr>
            <td>{{expense.category}}</td>
            <td>{{expense.cost}}</td> 
            <td><a href="{% url 'daily-panel' %}?date={{expense.date|date:'Y-m-d'}}">{{expense.date|date:"M-d"|slice:"0:"}}</a></td>
            <td>{{expense.description|truncatechars:80}}</td>
            <td><a href="{% url 'expense-update' expense.pk %}" class="open-incident" data-popup-url="{% url 'expense-update' expense.pk %}" ><span id="change-icon" class="material-symbols-outlined">edit</span></a></td>
            <td><a href="{% url 'expense-delete' expense.pk %}" class="open-incident" data-popup-url="{% url 'expense-delete' expense.pk %}"><span id="delete-icon" class="material-symbols-outlined">close</span></a></td>
            
        </tr>
        {% endfor %}
    </tbody>
  </table>
  <a href="{% url 'expense-list' %}?year={{year}}&month={{month}}">View More</a>
{% endblock %}


{% block spending %}
<h4>Spending</h4>
<h4>This Month's Spending: {{month_expenditure}}</h4>
<p>{{monthly_budget_indicator}}</p>
{% endblock %}

{% block budgets %}
  {% if monthlybudget %}
    <h4>Monthly Spending Budget: {{monthlybudget}}</h4>
    <progress max="{{monthlybudget}}" value="{{month_expenditure}}"></progress>
      {% if surpass %}
      <h5>Monthly expenditure has exceeded the Monthly budget</h5>
      {% endif %}
      <a href="{% url 'monthlybudget-update' monthlybudget_object.pk %}" class="open-incident" data-popup-url="{% url 'monthlybudget-update' monthlybudget_object.pk %}">Edit spending budget</a>
  {% else %}
    <a href="{% url 'monthlybudget-create' %}?year={{year}}&month={{month}}" class="open-incident" data-popup-url="{% url 'monthlybudget-create' %}?year={{year}}&month={{month}}">Add Spending Budget for Month</a>
  {% endif %}
{% endblock %}

{% block add-expense %}
<a href="{% url 'expense-create' %}" class="open-incident btn btn-info" data-popup-url="{% url 'expense-create' %}">ADD Expense</a>
{% endblock %}


{% block b3 %}

  {% if expenditure_per_month %}
    <h4>Average Spending per Month: {{expenditure_per_month}}</h4>
  {% else %}
    <h4>Average Spending per Month: ~Needs two weeks of data </h4>
  {% endif %}

{% endblock %}




{% block chart %}
<h4>Pie Chart</h4>
{% include 'base/pie_chart.html' %}
{% endblock %}

{% block bc %}
{% include 'base/bar_graph.html' %}
{% endblock %}

{% block subscription-table %}
<h4>Active Subscriptions</h4>
  {% for subscription in active_subscriptions %}
  <h4>{{subscription.name}}</h4>
  {% endfor %}
<h4>Was Active Subscriptions</h4>
  {% for subscription in was_active_subscriptions %}
  <h4>{{subscription.name}}</h4>
  {% endfor %}
{% endblock %}

