{% extends 'base/summary_layout.html' %}


{% block custom-script %}
  <script>
    // This listens for any changes in DOM. If there are any changes, hide the datepicker calendar
    // $(document).bind("DOMSubtreeModified", function() {
    //   $(".ui-datepicker-calendar").hide();
    // });

    // Datepicker for month and year ONLY. 
  //   $(function () {     
  //     $("#datepicker").datepicker({
  //       buttonImage: "https://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
  //       buttonImageOnly: true,
  //       changeMonth: true,
  //       changeYear: true,
  //       showButtonPanel: true,
  //       showOn: 'both',
  //       // When DONE is clicked, submit form and data as a string 'mm/yy'
  //       onClose: function(dateText, inst) {
  //         let month = $(".ui-datepicker-month :selected").val();
  //         let year = $(".ui-datepicker-year :selected").val();
  //         $(this).val($.datepicker.formatDate("mm/yy", new Date(year, month)));
  //         // $(this).val($.datepicker.formatDate("mm/dd/yy", new Date(year, month, 1)));

  //         $('#dateform').submit();
  //       }
  //     });
  //   });
  // </script>
{% endblock %}


{% block container-header %}
<h4 style="display: inline">Monthly Panel: {{month_name}}, {{year}}</h4>
<form id="dateform" action="{% url 'monthly-panel' %}" method="GET" style="display: inline">
  <input type="hidden" name="date" id="datepicker">
</form>
{% endblock %}



{% block expense-table %}
<h4>Recent Expenses</h4>
<table class="table table-sm table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Category</th>
        <th scope="col">Cost</th>
        <th scope="col">Date</th>
        <th scope="col">Description</th>
      </tr>
    </thead>
    <tbody>
        {% for expense in limited_expenses %}
        <tr>
            <td>{{expense.category}}</td>
            <td>{{expense.cost}}</td>
            <td>{{expense.date|date:"M-d"|slice:"0:"}}</td>
            <td>{{expense.description}}...</td>
        </tr>
        {% endfor %}
    </tbody>
  </table>
  <a href="{% url 'expense-list' %}?year={{year}}&month={{month}}">View More</a>
{% endblock %}


{% block spending %}
<h4>Spending</h4>
<h4>This Month's Spending: {{month_expenditure}}</h4>
{% endblock %}

{% block budgets %}
  {% if monthlybudget %}
    <h4>Monthly Spending Budget: {{monthlybudget}}</h4>
    <progress max="{{monthlybudget}}" value="{{month_expenditure}}"></progress>
      {% if surpass %}
      <h5>Monthly expenditure has exceeded the Monthly budget</h5>
      {% endif %}
      <a href="{% url 'monthlybudget-update' monthlybudget_object.pk %}">Edit spending budget</a>
  {% else %}
    <a href="{% url 'monthlybudget-create' %}?year={{year}}&month={{month}}">Add Spending Budget for Month</a>
  {% endif %}
{% endblock %}

{% block add-expense %}
<a href="{% url 'expense-create' %}" class="open-incident btn btn-info" data-popup-url="{% url 'expense-create' %}">ADD Expense</a>
{% endblock %}

{% block subscription-table %}
<h4>Active Subscriptions</h4>
  {% for subscription in active_subscriptions %}
  <h4>{{subscription.category}} {{subscription.cost}}</h4>
  {% endfor %}
{% endblock %}

{% block b3 %}

  {% if expenditure_per_month %}
    <h4>Average Spending per Month: {{expenditure_per_month}}</h4>
  {% else %}
    <h4>Average Spending per Month: ~Needs two weeks of data </h4>
  {% endif %}



{% endblock %}




{% block chart %}
<h4>Pie Chart</h4>
{% include 'base/pie_chart.html' %}

{% endblock %}

{% block bc %}
{% include 'base/bar_graph.html' %}
{% endblock %}